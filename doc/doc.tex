\documentclass[11pt, a4paper]{article}

\usepackage[english,francais]{babel}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[pdftex]{graphicx}
\usepackage{setspace}
\usepackage[french]{varioref}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{geometry}
\usepackage[french, ruled]{algorithm2e}
\geometry{margin=2cm}

\usepackage{tikz}
\usetikzlibrary{calc}   % coordinate calculation
\usepackage{xifthen}

\title{Rassemblement d'agents mobiles}
\author{\'Eloi Perdereau}
%\date{}

\newcommand{\case}[3] {
  \begin{tikzpicture}[thick, scale=0.6]
    \def \step {1}
    \def \cc {\step/2}  % center of cell
    \coordinate (offset) at ($#1 + (\cc,\cc)$);
    \draw[step=\step] #1 grid ($#1 + (3,3)$);   % draw the grid, base at #1
    % draw the center circle
    \draw ($(1,1) + (offset)$) circle (\cc*0.8);
    % draw the neighbors
    \foreach \coord in #2 {
      \coordinate[at=\coord, name=A];
      \draw ($(A) + (offset)$) circle ({\cc*0.8});
    }
    % draw the movement arrow if #3 is not empty
    \ifthenelse{\equal{#3}{}}{}{
    \draw[->] ($(1,1) + (offset)$) -- ($#3 + (offset)$);
    }
  \end{tikzpicture}
}

\begin{document}

\maketitle

\section{Cas}

Les cas symétriques sont omis.

\subsection{0 ou 1 voisins}
\case {(0,0)}  {{}}                        {}
\case {(0,0)}  {{(0,0)}}                   {(0,0)}
\case {(4,0)}  {{(1,0)}}                   {(1,0)}

\subsection{2 voisins}
\case {( 0,0)} {{(2,0),(1,0)}}             {(1,0)}
\case {( 4,0)} {{(2,1),(1,0)}}             {(2,0)}
\case {( 8,0)} {{(0,0),(2,0)}}             {(1,0)}
\case {(12,0)} {{(0,0),(2,1)}}             {(1,0)}
\case {(16,0)} {{(0,2),(2,0)}}             {}
\case {(20,0)} {{(0,1),(2,1)}}             {}

\subsection{3 voisins}
\case {( 0,0)} {{(0,0),(1,0),(2,0)}}       {(1,0)}
\case {(20,0)} {{(2,0),(1,0),(2,1)}}       {(2,0)}
\case {( 4,0)} {{(0,0),(1,0),(2,1)}}       {(1,0)}
\case {(16,0)} {{(0,0),(2,1),(2,0)}}       {(1,0)}
\case {( 8,0)} {{(0,0),(2,1),(2,2)}}       {(1,0)}
\case {(12,0)} {{(0,0),(0,1),(2,1)}}       {} \\

\case {( 0,4)} {{(0,2),(2,2),(2,0)}}       {}
\case {( 4,4)} {{(0,2),(2,2),(1,0)}}       {}
\case {( 8,4)} {{(1,0),(0,1),(2,1)}}       {}
\case {(12,4)} {{(1,2),(0,1),(2,0)}}       {}

\subsection{4 voisins}
\case {(0,0)} {{(0,0),(1,0),(2,0),(2,1)}} {(1,0)}
\case {(0,0)} {{(0,0),(1,0),(2,0),(2,2)}} {}
\case {(0,0)} {{(0,0),(1,0),(2,0),(1,2)}} {} \\

\case {(0,0)} {{(0,2),(1,2),(2,1),(2,0)}} {}
\case {(0,0)} {{(0,2),(1,2),(2,1),(1,0)}} {}
\case {(0,0)} {{(0,2),(1,2),(2,1),(0,0)}} {}
\case {(0,0)} {{(0,0),(1,0),(2,1),(0,1)}} {} \\

\case {(0,0)} {{(0,2),(1,2),(2,0),(1,0)}} {}
\case {(0,0)} {{(0,2),(1,2),(2,0),(0,0)}} {}
\case {(0,0)} {{(0,2),(1,2),(2,0),(0,1)}} {}
\case {(0,0)} {{(0,2),(1,2),(1,0),(0,0)}} {}
\case {(0,0)} {{(0,2),(2,2),(2,0),(0,0)}} {}
\case {(0,0)} {{(1,2),(2,1),(1,0),(0,1)}} {}


\subsection{5 voisins et plus}
Pour énumérer les cas avec 5 et 6 robots voisins, il suffit de prendre le
complémentaire des cas avec respectivement 3 et 2 robots voisins.
Aucun de ces cas n'entraine un mouvement de la part du robot concerné.

\subsection{Extension}

Tel quels, les cas 6 et 13 peuvent conduire à une déconnexion de l'espace. Pour
y remédier, il faut que chaque robot mémorise son entourage d'une ronde sur
l'autre (il ne retient que son entourage précédent.) Puis, si à la ronde
précédente, il était dans le cas 6 ou 13, il faut qu'il vérifie si au moins une
des cases suivante contient un robot : à droite, en bas et en bas à droite. Si
ce n'est pas le cas, il revient à sa position précédente. Les cas symétriques
sont définis de façon analogues. \\

Après avoir réglé ces cas de déconnexions, un autre problème survient avec les
cas 5 et 6. Il se peut que l'espace alterne entre deux états ce qui rend le
rassemblement impossible. Le problème vient du fait que des robots disposés en
quinconce soient de nouveau en quinconce à la ronde suivante (avec des
positions inversés.) Et ainsi, revenir à la position qu'ils occupaient deux
rondes plus tôt.  Pour y remédier, on va de nouveau utiliser l'entourage de
la ronde précédente : Si à la ronde précédente, un robot était dans le cas 5 ou
6, et qu'il est désormais dans le cas opposé, alors il ne bouge pas pour cette
ronde. \\

\subsection{Formalisation}
\begin{algorithm}[H]
  $finish \leftarrow False$\;
  $k \leftarrow 0$\;
  \While{not $finish$} {
    $N_k \leftarrow get\_neighbors()$\;
    \eIf{$k \% 2 = 0$} {
      % test d'arrêt
      \If{$N_k$ is case $1.1.1$ or \\
          ($N_k$ is case $1.1.2$ or $1.1.3$ or $1.3.2$ and
          $N_{k-2} = sym(N_k)$)} {
          $finish \leftarrow True$\;
          continue\;
      }
      % mouvement si non quinconce
      \eIf{$N_k$ is case $1.2.3$ or $1.2.4$ and $N_{k-2} = sym(N_k)$} {
        don't move (quincunx case)\;
      } {
        move according to $N_k$\;
      }
    } {
      \If{($N_{k-1}$ is case $1.2.4$ or $1.3.5$) and
          ($(i,j+1)$, $(i-1,j)$, $(i-1,j+1)$ are all empty)} {
          move to $(i-1,j)$\;
      }
    }
    $k \leftarrow k+1$\;
  }
  \caption{}
\end{algorithm}

\section{Calcul du temps de rassemblement dans le cas d'un bloc (draft)}

\subsection{Cas paire}

Bloc de taille $n$ par $n$ avec $n \geq 3$.

On ne considère que un côté (les trois autres sont similaires)

$R$ : le plus petit rectangle englobant tous les robots

\paragraph{Première étape} De bloc à disque

Les deux cases prises par les robots sur les bords du côtés se libèrent à
chaque ronde. Donc à chaque ronde, le nombre de robots sur le côté diminue de
2. Le temps pour qu'il ne reste plus que 4 robots est
\[ \frac{n-4}{2} \]

\paragraph{Deuxième étape} Effondrement du disque (ou du cercle)

Le côté ne contient plus que 4 robots adjacents. Donc au bout de deux
étapes, il s'effondre. On se rend compte que tant que $n \geq 3$,
après chaque effondrement, le côté contient de nouveau 4 robots adjacents. Donc,
pour que l'espace devienne un bloc de taille 2 par 2 (cas terminal), il faut
que chaque côté "descendent" de $n/2-1$, soit un nombre d'étapes de
\[ ( \frac{n}{2} -1 ) *2 \]
Puis il faut une dernière ronde pour que les robots se rendent compte qu'ils
ont terminés.

\paragraph{Totaux} Le temps total $T$ pour que un bloc se rassemble
est donc :

\[ T = ( \frac{n}{2} -1 ) *2 + \frac{n-4}{2} + 1 \]
\[ T = n + \frac{n}{2} - 3 \]


\subsection{Cas impaire}

Le cas impaire est assez similaire :
On utilise des côtés qui ont 3 robots adjacents, et "descendent" en deux
étapes.

\paragraph{Première étape}
\[ \frac{n-3}{2} \]

\paragraph{Deuxième étape}
\[ ( \frac{n-1}{2} ) *2 \]
Pas de ronde en plus après la deuxième étape.

\subsection{Cas général (paire et impaire)}
\[ n + \left\lceil \frac{n}{2} \right\rceil -3 \]
Formule vérifiée pour des blocs de côtés de taille 3 à 50 de côtés de taille 3
à 100.

\subsection{Généralisation aux rectangles}

On considère des rectangles de taille $m$ par $n$ avec $m \leq n$.

\[
    \left\lceil \frac{n-4}{2} \right\rceil
  + 2*\left\lfloor \frac{m}{2} \right\rfloor
  -2\ si\ m\ pair
  +1\ si\ m\ ou\ n\ pair
\]

\subsection{Généralisation aux carrés (blocs vides)}

Tout ce qui a été dis sur les blocs peut s'appliquer (et a été vérifié) aux
carrés et aux rectangles. On peut associer les robots qui forment le contour du
bloc aux robots qui forment le cercle. Puis, on se rend compte que à chaque
étape, les robots correspondant deux à deux prendront la même décision.

\end{document}
